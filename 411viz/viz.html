<!DOCTYPE html>
<!-- saved from url=(0048)http://atacama411.web.engr.illinois.edu/viz.html -->
<html style=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

</head>
<body>
<!--svg width="700" height="700"></svg-->
<svg id="id_svg_viz" width="1920" height="984"><rect width="1920" height="984" style="fill: none; pointer-events: all; -webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect><g><g class="links"><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="936.0964943422957" y2="810.2958277512774"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1013.8799571990816" y2="649.1981300797066"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1060.7156981540352" y2="908.5249791868212"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="691.071484299859" y2="510.5082637289693"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="847.5922701912544" y2="204.32594090391973"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="744.2320298838931" y2="670.4980024372851"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="778.3153153917684" y2="314.4030148588446"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="565.1336344521909" y2="547.7936013436178"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="934.0391206624172" y2="302.00599699517363"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1337.7593525517677" y2="593.046412749309"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1302.2116295693415" y2="452.0552815677153"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1060.3824103118743" y2="770.7564522387737"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="975.3903577415875" y2="178.90117467448314"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="889.1748788329444" y2="81.26685523244751"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="890.1246983506335" y2="688.5824862406895"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="613.0820010966698" y2="406.3553502208891"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="827.3235448615417" y2="540.3149543268698"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1162.362128859879" y2="439.7548174011033"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1182.7361745475832" y2="826.9566305914796"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1042.124611416335" y2="67.11586087041262"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1103.9916945830214" y2="197.46112113202582"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="864.6812087947877" y2="411.98022179995775"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="765.949496945751" y2="823.6178238482024"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1338.7728581872607" y2="321.542502523243"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1184.0408500744384" y2="582.6924345061225"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1248.300044817182" y2="699.6008825683776"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="1203.621202920282" y2="308.4861302073659"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="613.950739298325" y2="692.0023391178951"></line><line stroke-width="2" x1="964.7891430904839" y1="495.6446664412969" x2="658.154968571512" y2="264.3118444557226"></line><line stroke-width="2" x1="936.0964943422957" y1="810.2958277512774" x2="1013.8799571990816" y2="649.1981300797066"></line><line stroke-width="2" x1="936.0964943422957" y1="810.2958277512774" x2="1060.3824103118743" y2="770.7564522387737"></line><line stroke-width="2" x1="936.0964943422957" y1="810.2958277512774" x2="890.1246983506335" y2="688.5824862406895"></line><line stroke-width="2" x1="1013.8799571990816" y1="649.1981300797066" x2="1060.3824103118743" y2="770.7564522387737"></line><line stroke-width="2" x1="1013.8799571990816" y1="649.1981300797066" x2="890.1246983506335" y2="688.5824862406895"></line><line stroke-width="2" x1="691.071484299859" y1="510.5082637289693" x2="613.0820010966698" y2="406.3553502208891"></line><line stroke-width="2" x1="847.5922701912544" y1="204.32594090391973" x2="778.3153153917684" y2="314.4030148588446"></line><line stroke-width="2" x1="847.5922701912544" y1="204.32594090391973" x2="934.0391206624172" y2="302.00599699517363"></line><line stroke-width="2" x1="847.5922701912544" y1="204.32594090391973" x2="975.3903577415875" y2="178.90117467448314"></line><line stroke-width="2" x1="847.5922701912544" y1="204.32594090391973" x2="889.1748788329444" y2="81.26685523244751"></line><line stroke-width="2" x1="778.3153153917684" y1="314.4030148588446" x2="934.0391206624172" y2="302.00599699517363"></line><line stroke-width="2" x1="778.3153153917684" y1="314.4030148588446" x2="864.6812087947877" y2="411.98022179995775"></line><line stroke-width="2" x1="778.3153153917684" y1="314.4030148588446" x2="658.154968571512" y2="264.3118444557226"></line><line stroke-width="2" x1="934.0391206624172" y1="302.00599699517363" x2="975.3903577415875" y2="178.90117467448314"></line><line stroke-width="2" x1="934.0391206624172" y1="302.00599699517363" x2="889.1748788329444" y2="81.26685523244751"></line><line stroke-width="2" x1="934.0391206624172" y1="302.00599699517363" x2="1103.9916945830214" y2="197.46112113202582"></line><line stroke-width="2" x1="934.0391206624172" y1="302.00599699517363" x2="864.6812087947877" y2="411.98022179995775"></line><line stroke-width="2" x1="1060.3824103118743" y1="770.7564522387737" x2="890.1246983506335" y2="688.5824862406895"></line><line stroke-width="2" x1="975.3903577415875" y1="178.90117467448314" x2="889.1748788329444" y2="81.26685523244751"></line><line stroke-width="2" x1="975.3903577415875" y1="178.90117467448314" x2="1042.124611416335" y2="67.11586087041262"></line><line stroke-width="2" x1="975.3903577415875" y1="178.90117467448314" x2="1103.9916945830214" y2="197.46112113202582"></line><line stroke-width="2" x1="975.3903577415875" y1="178.90117467448314" x2="864.6812087947877" y2="411.98022179995775"></line><line stroke-width="2" x1="889.1748788329444" y1="81.26685523244751" x2="1042.124611416335" y2="67.11586087041262"></line><line stroke-width="2" x1="1042.124611416335" y1="67.11586087041262" x2="1103.9916945830214" y2="197.46112113202582"></line></g><g class="nodes"><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=19311"><foreignobject height="110" width="110" x="914.7891430904839" y="445.6446664412969" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Outdoor Girls in Florida; Or, Wintering in the Sunny South<br><br>Laura Lee Hope</div></body><title>The Outdoor Girls in Florida; Or, Wintering in the Sunny South
Laura Lee Hope</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=19294"><foreignobject height="110" width="110" x="886.0964943422957" y="760.2958277512774" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Outdoor Girls on Pine Island; Or, A Cave and What It Contained<br><br>Laura Lee Hope</div></body><title>The Outdoor Girls on Pine Island; Or, A Cave and What It Contained
Laura Lee Hope</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=18421"><foreignobject height="110" width="110" x="963.8799571990816" y="599.1981300797066" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Bunny Brown and His Sister Sue Keeping Store<br><br>Laura Lee Hope</div></body><title>Bunny Brown and His Sister Sue Keeping Store
Laura Lee Hope</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=17165"><foreignobject height="110" width="110" x="1010.7156981540352" y="858.5249791868212" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>A Little Florida Lady<br><br>Dorothy C. Paine</div></body><title>A Little Florida Lady
Dorothy C. Paine</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=20474"><foreignobject height="110" width="110" x="641.071484299859" y="460.5082637289693" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Grace Harlowe's Fourth Year at Overton College<br><br>Josephine Chase</div></body><title>Grace Harlowe's Fourth Year at Overton College
Josephine Chase</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21464"><foreignobject height="110" width="110" x="797.5922701912544" y="154.32594090391973" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Gilpins and their Fortunes: A Story of Early Days in Australia<br><br>William Henry Giles Kingston</div></body><title>The Gilpins and their Fortunes: A Story of Early Days in Australia
William Henry Giles Kingston</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=19731"><foreignobject height="110" width="110" x="694.2320298838931" y="620.4980024372851" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Under the Ocean to the South Pole; Or, the Strange Cruise of the Subma<br><br>Roy Rockwood</div></body><title>Under the Ocean to the South Pole; Or, the Strange Cruise of the Submarine Wonder
Roy Rockwood</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=15541"><foreignobject height="110" width="110" x="728.3153153917684" y="264.4030148588446" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>What Two Children Did<br><br>Charlotte E. Chittenden</div></body><title>What Two Children Did
Charlotte E. Chittenden</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=20087"><foreignobject height="110" width="110" x="515.1336344521909" y="497.79360134361775" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Pony Rider Boys in Texas; Or, The Veiled Riddle of the Plains<br><br>Frank Gee Patchin</div></body><title>The Pony Rider Boys in Texas; Or, The Veiled Riddle of the Plains
Frank Gee Patchin</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21626"><foreignobject height="110" width="110" x="884.0391206624172" y="252.00599699517363" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Adrift in the Wilds; Or, The Adventures of Two Shipwrecked Boys<br><br>Edward Sylvester Ellis</div></body><title>Adrift in the Wilds; Or, The Adventures of Two Shipwrecked Boys
Edward Sylvester Ellis</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=14859"><foreignobject height="110" width="110" x="1287.7593525517677" y="543.046412749309" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Daddy Takes Us to the Garden / The Daddy Series for Little Folks<br><br>Howard Roger Garis</div></body><title>Daddy Takes Us to the Garden / The Daddy Series for Little Folks
Howard Roger Garis</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=20632"><foreignobject height="110" width="110" x="1252.2116295693415" y="402.0552815677153" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Molly Brown's Orchard Home<br><br>Nell Speed</div></body><title>Molly Brown's Orchard Home
Nell Speed</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=17064"><foreignobject height="110" width="110" x="1010.3824103118743" y="720.7564522387737" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Story of a Plush Bear<br><br>Laura Lee Hope</div></body><title>The Story of a Plush Bear
Laura Lee Hope</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21479"><foreignobject height="110" width="110" x="925.3903577415875" y="128.90117467448314" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The South Sea Whaler<br><br>William Henry Giles Kingston</div></body><title>The South Sea Whaler
William Henry Giles Kingston</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21404"><foreignobject height="110" width="110" x="839.1748788329444" y="31.26685523244751" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>From Powder Monkey to Admiral: A Story of Naval Adventure<br><br>William Henry Giles Kingston</div></body><title>From Powder Monkey to Admiral: A Story of Naval Adventure
William Henry Giles Kingston</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=19969"><foreignobject height="110" width="110" x="840.1246983506335" y="638.5824862406895" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Moving Picture Girls at Oak Farm / or, Queer Happenings While Taki<br><br>Laura Lee Hope</div></body><title>The Moving Picture Girls at Oak Farm / or, Queer Happenings While Taking Rural Plays
Laura Lee Hope</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=20342"><foreignobject height="110" width="110" x="563.0820010966698" y="356.3553502208891" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Grace Harlowe's Problem<br><br>Josephine Chase</div></body><title>Grace Harlowe's Problem
Josephine Chase</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21498"><foreignobject height="110" width="110" x="777.3235448615417" y="490.31495432686984" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>France and the Republic / A Record of Things Seen and Learned in the F<br><br>William Henry Hurlbert</div></body><title>France and the Republic / A Record of Things Seen and Learned in the French Provinces / During the 'Centennial' Year 1889
William Henry Hurlbert</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21105"><foreignobject height="110" width="110" x="1112.362128859879" y="389.7548174011033" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Teddy / The Story of a Little Pickle<br><br>John C. Hutcheson</div></body><title>Teddy / The Story of a Little Pickle
John C. Hutcheson</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=13964"><foreignobject height="110" width="110" x="1132.7361745475832" y="776.9566305914796" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Lippincott's Magazine of Popular Literature and Science, Volume 12, No<br><br>Various</div></body><title>Lippincott's Magazine of Popular Literature and Science, Volume 12, No. 31, October, 1873
Various</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21358"><foreignobject height="110" width="110" x="992.124611416335" y="17.115860870412618" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Ocean Cat's Paw: The Story of a Strange Cruise<br><br>George Manville Fenn</div></body><title>The Ocean Cat's Paw: The Story of a Strange Cruise
George Manville Fenn</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21306"><foreignobject height="110" width="110" x="1053.9916945830214" y="147.46112113202582" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Dick o' the Fens: A Tale of the Great East Swamp<br><br>George Manville Fenn</div></body><title>Dick o' the Fens: A Tale of the Great East Swamp
George Manville Fenn</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=12176"><foreignobject height="110" width="110" x="814.6812087947877" y="361.98022179995775" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Gate of the Giant Scissors<br><br>Annie F. Johnston</div></body><title>The Gate of the Giant Scissors
Annie F. Johnston</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=17558"><foreignobject height="110" width="110" x="715.949496945751" y="773.6178238482024" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>My Life as an Author<br><br>Martin Farquhar Tupper</div></body><title>My Life as an Author
Martin Farquhar Tupper</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=12111"><foreignobject height="110" width="110" x="1288.7728581872607" y="271.542502523243" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Glories of Ireland<br><br> unknown author</div></body><title>The Glories of Ireland
 unknown author</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=12681"><foreignobject height="110" width="110" x="1134.0408500744384" y="532.6924345061225" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Us and the Bottle Man<br><br>Edith Ballinger Price</div></body><title>Us and the Bottle Man
Edith Ballinger Price</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=20646"><foreignobject height="110" width="110" x="1198.300044817182" y="649.6008825683776" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Nabob, Volume 1<br><br>Alphonse Daudet</div></body><title>The Nabob, Volume 1
Alphonse Daudet</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=18035"><foreignobject height="110" width="110" x="1153.621202920282" y="258.4861302073659" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Marjorie at Seacote<br><br>Carolyn Wells</div></body><title>Marjorie at Seacote
Carolyn Wells</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=21810"><foreignobject height="110" width="110" x="563.950739298325" y="642.0023391178951" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>The Wonder Island Boys: Treasures of the Islands<br><br>Roger Thompson Finlay</div></body><title>The Wonder Island Boys: Treasures of the Islands
Roger Thompson Finlay</title></foreignobject></a><a href="http://atacama411.web.engr.illinois.edu/viz.html?q=19855"><foreignobject height="110" width="110" x="608.154968571512" y="214.31184445572262" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><body><div><br>Louis' School Days: A Story for Boys<br><br>E. J. May</div></body><title>Louis' School Days: A Story for Boys
E. J. May</title></foreignobject></a></g></g></svg>
<br>
The center book is related to everything. Click on a book to find what it is related to.

<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: #fff;
  stroke-width: 1.5px;
}
body {  //for fullscreen:
  margin: 0;
  overflow: hidden;
}

mySvgRect{
  fill: lightsteelblue;	
}

div.tooltip {
  //position: absolute;	
  text-align: center;	
  width: 90px;	
  height: 90px;		
  padding: 2px;	
  font: 12px sans-serif;	
  background: lightsteelblue;	
  border: 1px;					
  border-radius: 4px;
 /*  pointer-events: none;	This line needs to be removed */
}

div {
  //position: absolute;	
  text-align: center;	
  width: 90px;	
  height: 90px;		
  padding: 2px;	
  font: 8px sans-serif;	
  color: black;
  background: lightsteelblue;	
  border: 0px;					
  border-radius: 4px;
 /*  pointer-events: none;	This line needs to be removed */
}

</style>

<script src="./viz_files/d3.v4.min.js"></script>
<!--script src="d3.v4.min.js"></script-->

<script>

var argv = function () {
  // This function is anonymous, is executed immediately and the return value is assigned to argv
  var query_string = {};
  var query = window.location.search.substring(1);
  var vars = query.split("&");
  for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
        // If first entry with this name
    if (typeof query_string[pair[0]] === "undefined") {
      query_string[pair[0]] = decodeURIComponent(pair[1]);
        // If second entry with this name
    } else if (typeof query_string[pair[0]] === "string") {
      var arr = [ query_string[pair[0]],decodeURIComponent(pair[1]) ];
      query_string[pair[0]] = arr;
        // If third or later entry with this name
    } else {
      query_string[pair[0]].push(decodeURIComponent(pair[1]));
    }
  } 
  return query_string;
}();
if(!("q" in argv)) {argv.q="19311";}; //"Life in the Medieval University";};
console.log("input: ",argv);
console.log("input: ",argv.q);
//console.log(argv['var1']);
//console.log(argv['var2']);
console.log(window.location.host+window.location.pathname);
var myURL = window.location.host+window.location.pathname;

// Define 'div' for tooltips
/*
var div = d3.select("body")
	.append("div")  // declare the tooltip div 
	.attr("class", "tooltip")              // apply the 'tooltip' class
	.style("opacity", 0);                  // set the opacity to nil
*/

var svg = d3.select("svg"),
    width = window.innerWidth,
    height = window.innerHeight;

svg.attr("width", width)
   .attr("height", height)

console.log(width+" "+height);

//restart layout without refreshing page
svg.selectAll('*').remove();

//zoom
svg.append("rect")
    .attr("width", width)
    .attr("height", height)
    .style("fill", "none")
    .style("pointer-events", "all")
    .call(d3.zoom()
        .scaleExtent([1 / 2, 4])
        .on("zoom", zoomed));

  var g = svg.append("g");

  function zoomed() {
    g.attr("transform", d3.event.transform);
  }

var color = d3.scaleOrdinal(d3.schemeCategory20);

var simulation;

d3.json("http://atacama.lloydramey.com/api/books/"+argv.q, function(error, result) {
//d3.json("http://atacama.lloydramey.com/api/books/search?q="+argv.q+"&page=0&count=1", function(error, result) {
  if (error) {return 1;}
  var title = result["title"];

  var author = "";
  author = result["authors"];
  if(author.length>0){
    author = author[0];
    author = author["name"];
    author = author;
  }
/* for search results
  var author = "";
  author = result["results"];
  if(author.length>0){
    author = author[0];
    author = author["authors"];
    if(author.length>0){
      author = author[0];
      author = author["name"];
      author = author;
    }
  }
  //console.log(author);
  var tags = result["results"][0]["tags"];
  for(let k=0;k<tags.length;k++)
    console.log(tags[k]["value"]);
*/
  var tags = result["tags"];
  for(let k=0;k<tags.length;k++)
    console.log(tags[k]["value"]);


//while(!author){console.log(author);}

//build query string
var query = "";
//query ="http://atacama.lloydramey.com/api/books/search?q=";
console.log(query);
console.log(argv.q);
query+=""+argv.q;
console.log(query);
if(title){
  console.log(title);
  query+=" "+title;
}
console.log(query);
if(author.length){
  console.log(author);
  query += " OR "+author;
}
console.log(query);
if(tags){
  for(let k=0;k<tags.length;k++){
    //query = " OR "+ query;
    if(tags[k]["value"])
      query+=" OR "+tags[k]["value"];
  }
}
console.log(query);
if(!argv.q && !title && !author && !tags)
  query+="*";
query+="&page=0&count=30";
query=query.replace(':', ' ');
query=query.replace(/\//g, ' '); //forward slash
query=query.replace('.', ' ');
var query ="http://atacama.lloydramey.com/api/books/search?q="+query;
console.log(query);


//d3.json("http://atacama.lloydramey.com/api/books/search?q="+argv.q+" AND "+author+"&page=0&count=30", function(error, graph) {
d3.json(query, function(error, graph) {
  if (error) throw error;

//console.log(graph);
var numNodes =  30;//Math.floor(Math.random() * 20 + 10);
graph=graph["results"];



graph.splice(numNodes,graph.length); //only keep 30 results

graph = { "nodes": graph, "links": [] }

//console.log(graph);
//console.log(graph.nodes);
//console.log(graph.links);

console.log(graph.nodes[0]);

//everything linked to center
for(var i=1; i<graph["nodes"].length;i++){
  graph["links"].push({"source":graph["nodes"][0].id,"target":graph["nodes"][i].id});
}

//links based on authors, tags, genres
var numLinks = 0;
for(var i=1;i<graph.nodes.length;i++){
  var nodei = graph.nodes[i];
 // if(numLinks>15)
 //   break;
  for(var j=i+1;j<graph.nodes.length;j++){
    var nodej = graph.nodes[j];

    var numCommonTags=0;
    for(var k=0;k<nodei.tags.length;k++){
      //console.log(nodei.tags[k])
      for(var n=0;n<nodej.tags.length;n++){
         if(nodei.tags[k].value == nodej.tags[n].value){
           numCommonTags+=1;
         }
      }
    }
    if(numCommonTags>=2){
       graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
       numLinks+=1;
       continue;
    }
  //  if(numLinks>15)
  //    break;
    var numCommonGenres=0;
    for(var k=0;k<nodei.genres.length;k++){
      for(var n=0;n<nodej.genres.length;n++){
         if(nodei.genres[k] == nodej.genres[n]){
           numCommonGenres+=1;
           numLinks+=1;
         }
      }
    }
    if(numCommonGenres>=2){
       graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
       numLinks+=1;
       continue;
    }

  //  if(numLinks>15)
  //    break;
    for(var k=0;k<nodei.authors.length;k++){
      //console.log("ok");
      for(var n=0;n<nodej.authors.length;n++){
         //console.log("author "+nodej.authors[n].name);
         if(nodei.authors[k].name == nodej.authors[n].name){
           //console.log("same authors"+nodei.authors[k].name);
           graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
           numLinks+=1;
         }
      }
    }
  }
}
/*some better ones:
http://localhost:8000/viz_solr.html?q=Bunny%20Brown%20and%20His%20Sister%20Sue%20Keeping%20Store
http://localhost:8000/viz_solr_node_text_wrap.html?q=Prisoners%20of%20Chance%20%20The%20Story%20of%20What%20Befell%20Geoffrey%20Benteen,%20Borderman,%20through%20His%20Love%20for%20a%20Lady%20of%20France
http://localhost:8000/viz_solr_node_text_wrap.html?q=Character%20Sketches%20of%20Romance,%20Fiction%20and%20the%20Drama,%20Vol.%203%20%20A%20Revised%20American%20Edition%20of%20the%20Reader%27s%20Handbook

some OK ones:
this one shows related ones
http://localhost:8000/viz_solr_node_text_wrap.html?q=Molly%20Brown%27s%20Orchard%20Home

some bad ones:
http://localhost:8000/viz_solr_node_text_wrap.html?q=The%20Black%20Prophet%20A%20Tale%20Of%20Irish%20Famine%20%20Traits%20And%20Stories%20Of%20The%20Irish%20Peasantry,%20The%20Works%20of%20/%20William%20Carleton,%20Volume%20Three
  has a near 4 clique
Edward John Thompson
  - author, no title
*/


//add some edges if there are none
if(numLinks<=2){
 if(graph["nodes"].length>=4){
  graph["links"].push({"source":graph["nodes"][1].id,"target":graph["nodes"][argv.q%2].id});
  //graph["links"].push({"source":graph["nodes"][argv.q%2].id,"target":graph["nodes"][argv.q%3].id});
  numLinks+=1;
  numLinks+=1;
 }
}
/*
  for(var i=1; i<graph["nodes"].length;i++){
    for(var j=i+1; j<graph["nodes"].length;j++){
      if(Math.random()>.98){
        graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
        numLinks+=1;
      }
    }
  }
}
*/
//still few links
/*
if(numLinks<=2){
  for(var i=1; i<graph["nodes"].length;i++){
    for(var j=i+1; j<graph["nodes"].length;j++){
      if(Math.random()>.99){
        graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
        numLinks+=1;
      }
    }
  }
}
*/

/*
//iterate over all nodes, make random graph
for(var i=1; i<graph["nodes"].length;i++){
  graph["links"].push({"source":graph["nodes"][0].id,"target":graph["nodes"][i].id});
}
if(graph.links.length==0)
for(var i=1; i<graph["nodes"].length/3;i++){
  for(var j=i+1; j<graph["nodes"].length/3;j++){
    if(Math.random()>.90)
      graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
  }
}
for(var i=graph["nodes"].length/3; i<graph["nodes"].length*2/3;i++){
  for(var j=i+1; j<graph["nodes"].length*2/3;j++){
    if(Math.random()>.90)
      graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
  }
}
for(var i=graph["nodes"].length*2/3; i<graph["nodes"].length;i++){
  for(var j=i+1; j<graph["nodes"].length;j++){
    if(Math.random()>.90)
      graph["links"].push({"source":graph["nodes"][i].id,"target":graph["nodes"][j].id});
  }
}
*/


  //draw line for each link
  var link = g.append("g")
      .attr("class", "links")
    .selectAll("line")
    .data(graph.links)
    .enter().append("line")
      .attr("stroke-width", 2);

  var node = g.append("g")
      .attr("class", "nodes")
    //.selectAll("image")
    .selectAll("foreignObject")
    .data(graph.nodes)
    .enter()
    .append("a") 
       //.attr("xlink:href", function(d){return "http://"+myURL+"?q="+d.title.replace(":", "").replace("/", "");}) 
       .attr("xlink:href", function(d){return "http://"+myURL+"?q="+d.id;}) 
    //.append("image")
    //  .attr("xlink:href",  function(d) { return "book_stock_small.a0756a6e.jpeg"} )
    .append("foreignObject")
      .attr("height","110")
      .attr("width","110")
      .each(function(d) {
         d3.select(this)
            //.attr('requiredFeatures','http://www.w3.org/TR/SVG11/feature#Extensibility')
            .append("xhtml:body").append("div").html(function(d) { 
               let txt = d.title.substring(0,70); //truncate length
               txt = "<br>"+txt;
               if(d.authors.length != 0)
                 txt+="<br><br>"+d.authors[0].name.substring(0,30)
               else
                 txt+="<br><br> unknown author"
               return txt; 
              })
            //.append('xhtml:body')
            //.append('xhtml:div')
            // .attr("class","tooltip")
            //.text("a big chunk of text that should wrap")
      })
/*
      .each(function(d) {
        d3.select(this).append("p")
          .text("hey there hey there text long enough");
          //.append("div").text("Hello World")
      })
    .append("rect")
      .attr("class", "mySvgRect")
      .attr("width", 110 )
      .attr("height", 110 )
      .attr("fill", "lightsteelblue" )
    .append("foreignObject")
      .each(function(d) {
        d3.select(this).append("p")
          .text("hey there");
          //.append("div").text("Hello World")
      })
*/
/*
    .on('mouseover', function(d){
        console.log("hovering"+this);
        d3.select(this).attr("height", "100")
                       .attr("width", "100")
                       .attr("xlink:href",  function(d) { return "book_stock_small.a0756a6e.jpeg"} );
                })
    .on('mouseout', function(d){
        console.log("not hovering");
        d3.select(this).attr("height", "100")
                       .attr("width", "100")
                       .attr("xlink:href",  function(d) { return "book_stock_small.a0756a6e.jpeg"} );
    })
*/
/*
    .on("mouseover", function(d) {		
              div.transition()
                .duration(500)	
                .style("opacity", 0);
              div.transition()
                 .duration(200)	
                 .style("opacity", .9);	
              let author;
              if(d.authors.length != 0)
                author=d.authors[0].name
              else
                author="unknown author"
              //div.html( d.title+'<br><br>By: '+author+'<br><br><a href="?q=' + d.title.replace(":", "").replace("/", "") +'">Explore books like this</a>' )
              div.html( d.title+'<br><br>By: '+author+'' )
                 .style("left", (d3.event.pageX) + "px")
                 .style("top", (d3.event.pageY - 28) + "px");
         })
    .on("mouseout", function(d) {		
              div.transition()
                .duration(500)	
                .style("opacity", .9);
              div.transition()
                 .duration(200)	
                 .style("opacity", 0);	
              div.html( "" )
                 .style("left", (d3.event.pageX) + "px")
                 .style("top", (d3.event.pageY - 28) + "px");
         })
*/
      .attr("height", "110") // "50") //these are important for on screen size
      .attr("width",  "110") //"50")
      .attr("x", -25)
      .attr("y", -25) //.attr("r", 10)
      //.attr("fill", function(d) { return color(d.group); })
      .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

/* this works! but no text box, got it from http://stackoverflow.com/questions/36348120/d3-appendforeignobject-only-adds-a-text-and-tspan-element
    .enter()
    .append("a") 
       .attr("xlink:href", function(d){return "http://"+myURL+"?q="+d.title.replace(":", "").replace("/", "");}) 
    //.append("image")
    //  .attr("xlink:href",  function(d) { return "book_stock_small.a0756a6e.jpeg"} )
    .append("foreignObject")
      .attr("height",50)
      .attr("width",50)
      .each(function(d) {
         d3.select(this).attr('requiredFeatures','http://www.w3.org/TR/SVG11/feature#Extensibility')
            .append('xhtml:div')
            //.attr("class","tooltip")
            .text("a big chunk of text that should wrap")
      })
*/


// when scroll over, displays text
  node.append("title")
      //.text(function(d) { return d.id; });
      .text(function(d) { 
           let txt = d.title;
           if(d.authors.length != 0)
              txt+="\n"+d.authors[0].name
           else
              txt+="\n unknown author"
           return txt; 
          });

/*
  svg.append("text")         // append text
    .style("fill", "black")   // fill the text with the colour black
    .attr("x", 0)           // set x position of left side of text
    .attr("y", height-50)           // set y position of bottom of text 
    .text("The center book is related to everything<br>Click on a book to find what it is related to.");
*/
  var C = .0145; //adjustable const
  var k = C * Math.sqrt( 1364*678 / graph.nodes.length); //width*height / graph.nodes.length);

  // custom force
  var paulsRepel = function() {
    function force(alpha){
      //console.log("ok");
      for(let i=0;i<graph.nodes.length;i++){
        for(let j=i+1;j<graph.nodes.length;j++){
          let node1=graph.nodes[i];
          let node2=graph.nodes[j];
          let dist = Math.sqrt(Math.pow(node1.x-node2.x,2)+Math.pow(node1.y-node2.y,2));
          if(dist < 130)
            dist = dist/50
          let ForceRepelx = -1*(k*k/dist)*(node1.x-node2.x); 
          let ForceRepely = -1*(k*k/dist)*(node1.y-node2.y); 
          node1.vx -= ForceRepelx*alpha;
          node1.vy -= ForceRepely*alpha;
          node2.vx += ForceRepelx*alpha;
          node2.vy += ForceRepely*alpha;
        }
      }
    }
    force.initialize = function(_) {
      nodes = _;
      //initialize();
    };
    return force;
  }

  // custom force
  var paulsAttract = function(links) {
    function index(d) {
       return d.index;
    }
    function find(nodeById, nodeId) {
       var node = nodeById.get(nodeId);
       //if (!node) throw new Error("missing: " + nodeId);
       return node;
    }
    var id = index,
        nodes,
        iterations = 1;

    if (links == null) links = [];
    function force(alpha){
      //console.log("ok");
      for(let i=0;i<links.length;i++){
        let link = links[i];
        let node1=link.source;
        let node2=link.target;
        console.log(node1.x);
        //console.log(node2.x);
        let dist_squared = Math.pow(node1.x-node2.x,2)+Math.pow(node1.y-node2.y,2); //no sqrt, so dist^2
        let ForceAttractx = (dist_squared/k)*(node1.x-node2.x); 
        let ForceAttracty = (dist_squared/k)*(node1.y-node2.y); 
        node1.vx -= ForceAttractx*alpha;
        node1.vy -= ForceAttracty*alpha;
        node2.vx += ForceAttractx*alpha;
        node2.vy += ForceAttracty*alpha;
      }
    }
    function initialize() {
      if (!nodes) return;
      var i,
          n = nodes.length,
          m = links.length,
          nodeById = d3.map(nodes, id),
          link;
      for (i = 0, count = new Array(n); i < m; ++i) {
        link = links[i], link.index = i;
        if (typeof link.source !== "object") link.source = find(nodeById, link.source);
        if (typeof link.target !== "object") link.target = find(nodeById, link.target);
      }
    }
    force.links = function(_) {
      return arguments.length ? (links = _, initialize(), force) : links;
    };
    force.id = function(_) {
      return arguments.length ? (id = _, force) : id;
    };
    force.initialize = function(_) {
      nodes = _;
      initialize();
    };
    return force;
  }







var paulsAttract2 = function(links) {
  function index(d) {
    return d.index;
  }

  function find(nodeById, nodeId) {
    var node = nodeById.get(nodeId);
    if (!node) throw new Error("missing: " + nodeId);
    return node;
  }
  function constant(x) {
    return function() {
      return x;
    };
  }
  function jiggle() {
    return (Math.random() - 0.5) * 1e-6;
  }
  var id = index,
      strength = defaultStrength,
      strengths,
      distance = constant(30),
      distances,
      nodes,
      count,
      bias,
      iterations = 1;

  if (links == null) links = [];

  function defaultStrength(link) {
    return 1 / Math.min(count[link.source.index], count[link.target.index]);
  }

  function force(alpha) {
      //console.log("starting buggy force");
      for(var i=0;i<links.length;i++){
        var link = links[i];
        var node1=link.source;
        var node2=link.target;
        //console.log(node1.x);
        //console.log(node2.x);
        var dist_squared = Math.pow(node1.x-node2.x,2)+Math.pow(node1.y-node2.y,2); //no sqrt, so dist^2
        if(dist_squared>1)
           dist_squared=1;
        var ForceAttractx = (dist_squared/k)*(node1.x-node2.x); 
        var ForceAttracty = (dist_squared/k)*(node1.y-node2.y); 
        node1.vx -= ForceAttractx*alpha;
        node1.vy -= ForceAttracty*alpha;
        node2.vx += ForceAttractx*alpha;
        node2.vy += ForceAttracty*alpha;
      }
/*
    for (var k = 0, n = links.length; k < iterations; ++k) {
      for (var i = 0, link, source, target, x, y, l, b; i < n; ++i) {
        link = links[i], source = link.source, target = link.target;
        x = target.x + target.vx - source.x - source.vx || jiggle();
        y = target.y + target.vy - source.y - source.vy || jiggle();
        l = Math.sqrt(x * x + y * y);
        l = (l - distances[i]) / l * alpha * strengths[i];
        x *= l, y *= l;
        target.vx -= x * (b = bias[i]);
        target.vy -= y * b;
        source.vx += x * (b = 1 - b);
        source.vy += y * b;
      }
    }
*/
  }

  function initialize() {
    if (!nodes) return;

    var i,
        n = nodes.length,
        m = links.length,
        nodeById = d3.map(nodes, id),
        link;

    for (i = 0, count = new Array(n); i < m; ++i) {
      link = links[i], link.index = i;
      if (typeof link.source !== "object") link.source = find(nodeById, link.source);
      if (typeof link.target !== "object") link.target = find(nodeById, link.target);
      count[link.source.index] = (count[link.source.index] || 0) + 1;
      count[link.target.index] = (count[link.target.index] || 0) + 1;
    }

    for (i = 0, bias = new Array(m); i < m; ++i) {
      link = links[i], bias[i] = count[link.source.index] / (count[link.source.index] + count[link.target.index]);
    }

    strengths = new Array(m), initializeStrength();
    distances = new Array(m), initializeDistance();
  }

  function initializeStrength() {
    if (!nodes) return;

    for (var i = 0, n = links.length; i < n; ++i) {
      strengths[i] = +strength(links[i], i, links);
    }
  }

  function initializeDistance() {
    if (!nodes) return;

    for (var i = 0, n = links.length; i < n; ++i) {
      distances[i] = +distance(links[i], i, links);
    }
  }

  force.initialize = function(_) {
    nodes = _;
    initialize();
  };

  force.links = function(_) {
    return arguments.length ? (links = _, initialize(), force) : links;
  };

  force.id = function(_) {
    return arguments.length ? (id = _, force) : id;
  };

  force.iterations = function(_) {
    return arguments.length ? (iterations = +_, force) : iterations;
  };

  force.strength = function(_) {
    return arguments.length ? (strength = typeof _ === "function" ? _ : constant(+_), initializeStrength(), force) : strength;
  };

  force.distance = function(_) {
    return arguments.length ? (distance = typeof _ === "function" ? _ : constant(+_), initializeDistance(), force) : distance;
  };

  return force;
}









    simulation = d3.forceSimulation()
    //.force("link", d3.forceLink().id(function(d) { return d.id; })
    //                           .distance(200)
    //                          .strength(0.3 /*reducing makes it more like spring*/))
    //.force("charge", d3.forceManyBody()
    //                 .strength(-5000 /*default -30*/) )
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("paulsRepel", paulsRepel())
    //.force("paulsAttract", paulsAttract().id(function(d) { return d.id; }));
    .force("paulsAttract", paulsAttract2().id(function(d) { return d.id; }));
        






  //set simulation's nodes to array of objects
  simulation
      .nodes(graph.nodes)
       //and set how we will update node positions
      .on("tick", ticked);

  //similar for edges
  //simulation.force("link")
  //    .links(graph.links);
  simulation.force("paulsAttract")
     .links(graph.links);
  //simulation
  //    .links(graph.links);

  function ticked() {

   

    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node
        //.attr("cx", function(d) { return d.x; }) //cx,cy are center of shape
        //.attr("cy", function(d) { return d.y; });
        .attr("x", function(d) { return d.x-50; })
        .attr("y", function(d) { return d.y-50; });
  }
}); //closing original d3.json("miserables.json", function(error, graph) {
}); //closing get authors

//on mouse click callback
function dragstarted(d) {
  if (!d3.event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

//on holding click
function dragged(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}

//on release click
function dragended(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}



</script>


</body></html>